generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}
model User {
  UserID     Int       @id @default(autoincrement())
  Username   String? @unique
  Password   String?
  Type       UserType?
  GoogleID   String? @unique
  Email      String? @unique
  LineUserID String?  @unique
  FCMToken   String?

  Student    Student?
  Officer    Officer?
  User_Role  User_Role[]
  Student_Enroll Student_Enroll[]
  PersonalEvent  PersonalEvent[]
  Notification   Notification[]
  ActivityPort   ActivityPort[]
  PostComment  PostComment[]
  Follow_ActivityPost Follow_ActivityPost[]
  ScholarshipApplication ScholarshipApplication[]
}
enum UserType {
  Student
  Officer
}
model Student {
  StudentID    Int    @id @default(autoincrement())
  StudentCode  Int? @unique
  Year         Int?
  Name         String?
  Surname      String?
  Picture      String?
  Semester     Int?
  Major        Major?
  Branch       Branch?
  UserID       Int  @unique
  User         User   @relation(fields: [UserID], references: [UserID])
}
enum Major {
  IT
  BIT
  AIT
  DSBA
}
enum Branch {
  MULTIMEDIA
  NETWORK
  SOFTWARE
}
model Officer {
  OfficerID Int   @id @default(autoincrement())
  Name      String?
  Surname   String?
  Picture   String?
  UserID    Int @unique

  User      User @relation(fields: [UserID], references: [UserID])
  ActivityPost ActivityPost[]
  Scholarship  Scholarship[]
  Welfare      Welfare[]
  Hospital     Hospital[]
  Post         Post[]
}
model User_Role {
  User_RoleID Int @id @default(autoincrement())
  RoleID      Int
  UserID      Int

  Role Role @relation(fields: [RoleID], references: [RoleID])
  User User @relation(fields: [UserID], references: [UserID])
}
model Role {
  RoleID    Int @id @default(autoincrement())
  RoleName  String?

  User_Role User_Role[]
}
model Student_Enroll {
  Student_EnrollID Int @id @default(autoincrement())
  SecID            Int
  UserID           Int

  Subject_Sec Subject_Sec @relation(fields: [SecID], references: [SecID])
  User        User        @relation(fields: [UserID], references: [UserID])
}
model Subject {
  SubjectID     Int    @id @default(autoincrement())
  Name          String?
  SubjectCode   String?
  MidtermExam   DateTime?
  FinalExam     DateTime?

  Subject_Sec   Subject_Sec[]
}
model Subject_Sec {
  SecID      Int      @id @default(autoincrement())
  Section    Int?
  StartTime  DateTime?
  EndTime    DateTime?
  StudyTime  StudyDay?
  Professor  String?
  Classroom  String?
  SubjectID  Int

  Subject        Subject        @relation(fields: [SubjectID], references: [SubjectID], onDelete: Cascade)
  Student_Enroll Student_Enroll[]
}
enum StudyDay {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}
model PersonalEvent {
  PersonalEventID Int @id @default(autoincrement())
  Title           String?
  Description     String?
  Deadline        DateTime?
  Notify          Boolean?
  NotifyDatetime  DateTime?
  UserID          Int

  User            User @relation(fields: [UserID], references: [UserID])
}
model Notification {
  NotificationID  Int @id @default(autoincrement())
  Title           String?
  Message         String?
  IsRead          Boolean?
  NotificationType NotificationType?
  ActionURL       String?
  IsSent       Boolean? @default(false)
  NotificationTime DateTime?
  UserID          Int
  User            User @relation(fields: [UserID], references: [UserID])
}
enum NotificationType {
  scholarship
  activity
  news
  selfevent
}
model Activity {
  ActivityID         Int             @id @default(autoincrement())
  ActivityName       String?
  Description        String?
  HourofActivity     Int?
  Location           String?
  DatetimeofActivity DateTime?
  Status             ActivityStatus? @default(waitforprocess) // เพิ่ม default
  Comment            String?
  ActivityPortID     Int
  RelatedPostID      Int?            
  RelatedPost        ActivityPost?   @relation(fields: [RelatedPostID], references: [ActivityPostID],onDelete: Cascade)

  ActivityPort       ActivityPort    @relation(fields: [ActivityPortID], references: [ActivityPortID], onDelete: Cascade)
  ActivityEvidence   ActivityEvidence[]
}
enum ActivityStatus {
  waitforprocess
  approve
  reject
}
model ActivityEvidence {
  EvidenceID  Int @id @default(autoincrement())
  Picture     String?
  ActivityID  Int

  Activity    Activity @relation(fields: [ActivityID], references: [ActivityID],onDelete: Cascade)
}
model ActivityPort {
  ActivityPortID Int @id @default(autoincrement())
  Portname       String?
  HourNeed       Int?
  Type           PortType?
  CreateDate     DateTime?
  EndDate        DateTime?
  UserID         Int
  status         PortStatus?
  User           User @relation(fields: [UserID], references: [UserID])
  ScholarshipID  Int?
  Scholarship    Scholarship? @relation(fields: [ScholarshipID], references: [ScholarshipID])
  Activity       Activity[]
}
enum PortStatus {
  active
  expired
  completed
}
enum PortType {
  Custom
  Scholarship
}

model ActivityPost {
  ActivityPostID     Int      @id @default(autoincrement())
  Title              String?
  Description        String?
  HourofActivity     Int?
  Location           String?
  DatetimeofActivity DateTime?
  
  Picture            String?  // ✅ เพิ่มบรรทัดนี้ (เก็บ URL รูปภาพ)

  OfficerID          Int
  Officer            Officer  @relation(fields: [OfficerID], references: [OfficerID])
  Follow_ActivityPost Follow_ActivityPost[]
  SubmittedActivities Activity[] 
}

model Follow_ActivityPost {
  Follow_ActivityID Int @id @default(autoincrement())
  ActivityPostID    Int
  UserID            Int

  ActivityPost ActivityPost @relation(fields: [ActivityPostID], references: [ActivityPostID],onDelete: Cascade)
  User         User         @relation(fields: [UserID], references: [UserID])
}

model Scholarship {
  ScholarshipID   Int @id @default(autoincrement())
  Scholarshipname String?
  Description     String? @db.Text
  Startdate       DateTime?
  Enddate         DateTime?
  AnnouceStudentInterviewday DateTime?
  Interviewplace  String?
  Interviewday    DateTime?
  WinnerAnnouceday DateTime?
  ActivityHourNeeded Int?  @default(0)
  ActivityDeadline DateTime?
  Picture         String?
  OfficerID       Int
  ActivityPorts    ActivityPort[]
  Officer Officer @relation(fields: [OfficerID], references: [OfficerID])
  ScholarshipRequirement ScholarshipRequirement[]
  ScholarshipApplication ScholarshipApplication[]
}

model ScholarshipRequirement {
  RequirementID Int @id @default(autoincrement())
  Name          String?
  Type          FileType?
  Require       Boolean?
  Description   String?
  ScholarshipID Int

  Scholarship   Scholarship @relation(fields: [ScholarshipID], references: [ScholarshipID],onDelete: Cascade)
  ScholarshipSubmission ScholarshipSubmission[]
}

enum FileType {
  picture
  document
}

model ScholarshipApplication {
  ApplicationID Int @id @default(autoincrement())
  ApplicationDate DateTime?
  Status        ApplyStatus?
  ScholarshipID Int
  UserID        Int 
  
  Scholarship   Scholarship @relation(fields: [ScholarshipID], references: [ScholarshipID],onDelete: Cascade)
  User          User        @relation(fields: [UserID], references: [UserID])
  ScholarshipSubmission ScholarshipSubmission[]

  @@unique([UserID, ScholarshipID])
}

enum ApplyStatus {
  waitingforprocess
  reject
  waitforinterview
  approve
}

model ScholarshipSubmission {
  SubmissionID   Int @id @default(autoincrement())
  StudentDocument String?
  ApplicationID  Int
  RequirementID  Int

  ScholarshipApplication ScholarshipApplication @relation(fields: [ApplicationID], references: [ApplicationID],onDelete: Cascade)
  ScholarshipRequirement ScholarshipRequirement @relation(fields: [RequirementID], references: [RequirementID],onDelete: Cascade)
}

model Welfare {
  WelfareID    Int           @id @default(autoincrement())
  WelfareType  WelfareType   
  Title        String
  Description  String?       @db.Text
  CoverImage   String?
  OfficerID    Int

  Officer      Officer       @relation(fields: [OfficerID], references: [OfficerID])
  Files        WelfareFile[]
}

model WelfareFile {
  WelfareFileID Int      @id @default(autoincrement())
  FileName      String
  FileUrl       String
  FileType      String?  // pdf, image
  WelfareID     Int

  Welfare       Welfare  @relation(fields: [WelfareID], references: [WelfareID])
}

enum WelfareType {
  registercourse
  healthcare
  scholarship
  petition
}

model Hospital {
  HospitalID   Int @id @default(autoincrement())
  HospitalName String?
  PlaceID      String?
  OfficerID    Int
  photourl      String? @db.Text
  province    String?
  latitude     Float?
  longitude    Float?
  Officer Officer @relation(fields: [OfficerID], references: [OfficerID])
}
model Post {
  PostID        Int      @id @default(autoincrement())
  Content       String? @db.Text
  Type          PostType?
  IsPinned      Boolean?      @default(false)
  NotifyType    NotifyType?
  Visibility    PostVisibilityType @default(PUBLIC) 
  Schedule_Time DateTime?
  ExpireDate    DateTime?
  CreateDate    DateTime?     @default(now())
  CanComment    Boolean?      @default(true)
  OfficerID     Int
  Officer       Officer       @relation(fields: [OfficerID], references: [OfficerID])
  PostPicture   PostPicture[]
  PostComment   PostComment[]
  PostTarget    PostTarget[]  
}
model PostTarget {
  PostTargetID  Int @id @default(autoincrement())
  PostID        Int
  Post          Post @relation(fields: [PostID], references: [PostID], onDelete: Cascade)
  TargetType    TargetType 
  TargetID      Int?     
  TargetExtraID Int?     
}
enum PostType {
  normal
  scholarship
  Welfare
  education
}

enum NotifyType {
  urgent
  schedule
  normal
  silent
}
enum PostVisibilityType {
  PUBLIC    
  SPECIFIC
}
enum TargetType {
  USER                  
  SECTION               
  SUBJECT               
  MAJOR                 
  YEAR_LEVEL            
  SCHOLARSHIP_STAR      
  ACTIVITY_STAR         
  ACTIVITY_FOLLOWER     
  SCHOLARSHIP_APPLICANT 
  YEAR_MAJOR          
}
model PostPicture {
  PostPictureID Int     @id @default(autoincrement())
  Picture       String?
  PostID        Int
  Post          Post    @relation(fields: [PostID], references: [PostID], onDelete: Cascade)
}

model PostComment {
  CommentID      Int       @id @default(autoincrement())
  Content        String?
  Comment_at     DateTime? @default(now())
  PostID         Int
  UserID         Int
  Parent_comment Int?      
  Parent         PostComment?  @relation("ReplyToComment", fields: [Parent_comment], references: [CommentID], onDelete: Cascade)
  Replies        PostComment[] @relation("ReplyToComment")

  Post           Post      @relation(fields: [PostID], references: [PostID], onDelete: Cascade)
  User           User      @relation(fields: [UserID], references: [UserID])
}
model AcademicCalendar {
  ID            Int           @id @default(autoincrement())
  AcademicYear  Int           // ปีการศึกษา เช่น 2568
  Semester      Int           // 1, 2, หรือ 3 (ภาคฤดูร้อน)
  Title         String        // ชื่อกิจกรรม (เอาไว้โชว์หน้าเว็บ) เช่น "ลงทะเบียนเรียนปกติ"
  EventType     EventType     // *สำคัญ* เอาไว้ให้ Code รู้ว่าต้องทำอะไร
  StartDate     DateTime
  EndDate       DateTime?     // ถ้าเป็นวันเดียวจบ ให้ใส่ null หรือค่าเดียวกับ StartDate
  
  Description   String?       // เก็บหมายเหตุเพิ่มเติม เช่น "ป.ตรี ปรับวันละ 50 บาท"
  IsProcessed   Boolean       @default(false) // เอาไว้กัน Cron Job รันซ้ำ

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

// Enum เพื่อระบุประเภทกิจกรรม ให้ Cron Job switch case ได้ง่ายๆ
enum EventType {
  TERM_START            // วันเปิดภาคการศึกษา
  PRE_REGISTRATION      // ลงทะเบียนล่วงหน้า
  ANNOUNCE_PRE_REGIS    // ประกาศผลลงทะเบียนล่วงหน้า
  REGISTRATION          // ลงทะเบียนปกติ
  PAYMENT_NO_FINE       // ชำระเงิน (ไม่มีค่าปรับ)
  PAYMENT_WITH_FINE     // ชำระเงิน (มีค่าปรับ)
  LATE_REGISTRATION     // ลงทะเบียนล่าช้า
  PAYMENT_LATE_REGIS    // ชำระเงิน (ลงทะเบียนล่าช้า)
  ADD_CHANGE_SUBJECT    // เพิ่ม/เปลี่ยนรายวิชา
  WITHDRAW_SUBJECT      // ถอนรายวิชา
  MIDTERM_EXAM          // สอบกลางภาค
  TEACHER_EVALUATION    // ประเมินผู้สอน
  LEAVE_DEADLINE        // วันสุดท้ายลาพัก/รักษาสภาพ
  CLASS_END             // วันสุดท้ายการเรียนการสอน
  FINAL_EXAM            // สอบปลายภาค
  GRADUATE_EXAM         // สอบจบ (ป.โท/เอก)
  TERM_END              // วันปิดภาคการศึกษา
  GRADE_SUBMISSION      // วันส่งเกรด
  SPECIAL_OPEN_REQ      // ขอเปิดรายวิชาภาคพิเศษ
}